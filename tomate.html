<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>‚è≥ Pomodoro Timer ‚Äî 25/5</title>
  <!-- Tailwind CSS desde CDN -->
  <script src="https://cdn.tailwindcss.com"></script>
  <meta name="theme-color" content="#7c3aed">
  <style>
    .ring-animated { animation: glow 1.2s infinite alternate ease-in-out; }
    @keyframes glow {
      from { box-shadow: 0 0 0px rgba(124,58,237,.0), 0 0 0px rgba(236,72,153,.0); }
      to   { box-shadow: 0 0 24px rgba(124,58,237,.30), 0 0 48px rgba(236,72,153,.25); }
    }
    /* Overtime: anello rosso pulsante */
    .overtime-glow {
      animation: overtimePulse 1s infinite alternate ease-in-out;
    }
    @keyframes overtimePulse {
      from { box-shadow: 0 0 0 rgba(239,68,68,0.0), 0 0 0 rgba(239,68,68,0.0); }
      to   { box-shadow: 0 0 24px rgba(239,68,68,.35), 0 0 48px rgba(239,68,68,.28); }
    }
  </style>
</head>
<body class="min-h-dvh bg-gradient-to-br from-fuchsia-100 via-white to-sky-100 text-gray-800 selection:bg-fuchsia-200/70">
  <main class="max-w-3xl mx-auto p-6 sm:p-8">
    <!-- Header -->
    <header class="text-center mb-8">
      <h1 class="text-3xl sm:text-4xl font-extrabold tracking-tight">
        üçÖ‚è≥ <span class="text-fuchsia-700">Pomodoro</span> Timer
      </h1>
      <p class="mt-2 text-sm sm:text-base text-gray-600">
        25 min de <strong>trabajo</strong> + 5 min de <strong>descanso</strong> = 1 ciclo ‚úÖ
      </p>
    </header>

    <!-- Timer Card -->
    <section id="card" class="transition-colors rounded-2xl bg-white/80 backdrop-blur shadow-lg ring-1 ring-gray-200 p-6 sm:p-8">
      <div class="flex flex-col sm:flex-row gap-6 sm:items-center">
        <!-- Emoji + Estado -->
        <div class="flex-1 text-center sm:text-left">
          <div id="emoji"
               class="text-7xl sm:text-8xl leading-none drop-shadow-sm transition-transform">
            üíº
          </div>
          <p id="phaseLabel" class="mt-2 text-lg font-semibold text-fuchsia-700">Trabajo</p>
          <p class="text-sm text-gray-500">Fase actual</p>
        </div>

        <!-- Display de tiempo -->
        <div class="flex-1">
          <div id="dial" class="relative mx-auto w-56 h-56 sm:w-64 sm:h-64 rounded-full bg-gradient-to-br from-fuchsia-500 to-pink-500 p-1 ring-animated">
            <div class="w-full h-full rounded-full bg-white flex items-center justify-center">
              <div class="text-center">
                <div id="time"
                     class="font-mono text-5xl sm:text-6xl font-black tabular-nums">
                  25:00
                </div>
                <p class="mt-1 text-xs uppercase tracking-widest text-gray-400">min:seg</p>
                <div class="mt-3">
                  <div class="w-40 sm:w-48 bg-gray-200 rounded-full h-2 overflow-hidden mx-auto">
                    <div id="progress" class="h-2 bg-gradient-to-r from-fuchsia-500 to-pink-500" style="width: 0%"></div>
                  </div>
                  <p id="progressText" class="mt-1 text-xs text-gray-500">0%</p>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Controles -->
        <div class="flex-1 grid grid-cols-3 gap-3 content-start">
          <button id="startBtn"
            class="col-span-3 sm:col-span-3 inline-flex items-center justify-center gap-2 rounded-xl bg-green-500 hover:bg-green-600 active:scale-[.98] text-white font-semibold py-3 transition">
            ‚ñ∂Ô∏è Iniciar
          </button>
          <button id="pauseBtn"
            class="inline-flex items-center justify-center gap-2 rounded-xl bg-amber-500 hover:bg-amber-600 active:scale-[.98] text-white font-semibold py-3 transition">
            ‚è∏Ô∏è Pausa
          </button>
          <button id="resetBtn"
            class="inline-flex items-center justify-center gap-2 rounded-xl bg-rose-500 hover:bg-rose-600 active:scale-[.98] text-white font-semibold py-3 transition">
            üîÑ Reiniciar
          </button>
          <button id="skipBtn"
            class="inline-flex items-center justify-center gap-2 rounded-xl bg-sky-500 hover:bg-sky-600 active:scale-[.98] text-white font-semibold py-3 transition">
            ‚è≠Ô∏è Saltar fase
          </button>
        </div>
      </div>

      <!-- Contadores -->
      <div class="mt-6 grid sm:grid-cols-3 gap-4 text-center">
        <div class="rounded-xl bg-fuchsia-50 p-4 ring-1 ring-fuchsia-200">
          <p class="text-xs uppercase tracking-wider text-fuchsia-700">Ciclos completados</p>
          <p id="completedCount" class="text-3xl font-extrabold">0</p>
        </div>
        <div class="rounded-xl bg-pink-50 p-4 ring-1 ring-pink-200">
          <p class="text-xs uppercase tracking-wider text-pink-700">Sesiones de trabajo</p>
          <p id="workCount" class="text-3xl font-extrabold">0</p>
        </div>
        <div class="rounded-xl bg-sky-50 p-4 ring-1 ring-sky-200">
          <p class="text-xs uppercase tracking-wider text-sky-700">Sesiones de descanso</p>
          <p id="breakCount" class="text-3xl font-extrabold">0</p>
        </div>
      </div>

      <!-- Notificaci√≥n visual -->
      <div id="notice"
           class="hidden mt-6 rounded-xl border border-amber-300 bg-amber-50 px-4 py-3 text-amber-800">
        <p class="font-semibold">‚è∞ ¬°Tiempo cumplido!</p>
        <p class="text-sm">Cuando quieras, cambia de fase o pausa. El contador marcar√° el retraso.</p>
      </div>
    </section>

    <!-- Explicaci√≥n -->
    <section class="mt-8 rounded-2xl bg-white/70 backdrop-blur ring-1 ring-gray-200 p-6">
      <h2 class="text-xl font-bold">¬øQu√© es la t√©cnica Pomodoro?</h2>
      <p class="mt-2 text-gray-700">
        La t√©cnica <em>Pomodoro</em> divide el trabajo en intervalos: normalmente
        <strong>25 minutos</strong> de concentraci√≥n profunda seguidos de
        <strong>5 minutos</strong> de descanso breve. Tras completar
        cuatro ‚Äúpomodoros‚Äù, suele hacerse un descanso m√°s largo. Este m√©todo ayuda
        a mejorar el enfoque, reducir la fatiga y avanzar de forma sostenida.
      </p>
    </section>

    <!-- Instrucciones -->
    <section class="mt-8 rounded-2xl bg-white/70 backdrop-blur ring-1 ring-gray-200 p-6">
      <h2 class="text-xl font-bold">Instrucciones de uso</h2>
      <ol class="mt-3 list-decimal pl-6 space-y-2 text-gray-700">
        
        <li>Haz clic en <strong>‚ñ∂Ô∏è Iniciar</strong> para comenzar la sesi√≥n de <em>Trabajo</em> (25:00).</li>
        <li>Puedes <strong>‚è∏Ô∏è Pausar</strong>, <strong>üîÑ Reiniciar</strong> o <strong>‚è≠Ô∏è Saltar fase</strong> cuando lo necesites.</li>
        <li>Al terminar un tramo, ver√°s una <strong>alerta visual</strong> y escuchar√°s un <strong>sonido</strong>.</li>
        <li>Si te pasas del tiempo, el marcador se pone <strong class="text-red-600">rojo</strong> y empieza el contador de <strong>retraso</strong>.</li>
        <li>Los contadores y el estado se guardan en tu navegador (localStorage).</li>
      </ol>
      <p class="mt-3 text-xs text-gray-500">Consejo: permite las notificaciones del sitio para ver avisos del sistema (opcional).</p>
      <a href="https://uzutano.github.io/" style="text-decoration: none; color: blue;">‚¨Ö HOME PAGE</a>
    </section>
  </main>

  <!-- Sonido (fallback desde CDN) -->
  <audio id="ding" preload="auto" crossorigin="anonymous">
    <source src="https://cdn.jsdelivr.net/gh/naptha/tinyfiles@latest/sounds/alarms/bell.mp3" type="audio/mpeg">
    <source src="https://cdn.jsdelivr.net/gh/naptha/tinyfiles@latest/sounds/alarms/bell.ogg" type="audio/ogg">
  </audio>

  <script>
    // -------------------------
    // Configuraci√≥n Pomodoro
    // -------------------------
    const WORK_MIN = 25;
    const BREAK_MIN = 5;

    // Elementos UI
    const timeEl = document.getElementById('time');
    const phaseLabelEl = document.getElementById('phaseLabel');
    const emojiEl = document.getElementById('emoji');
    const cardEl = document.getElementById('card');
    const dialEl = document.getElementById('dial');
    const noticeEl = document.getElementById('notice');
    const progressEl = document.getElementById('progress');
    const progressTextEl = document.getElementById('progressText');

    const startBtn = document.getElementById('startBtn');
    const pauseBtn = document.getElementById('pauseBtn');
    const resetBtn = document.getElementById('resetBtn');
    const skipBtn = document.getElementById('skipBtn');

    const completedCountEl = document.getElementById('completedCount');
    const workCountEl = document.getElementById('workCount');
    const breakCountEl = document.getElementById('breakCount');

    // Estado
    let isRunning = false;
    let isWorkPhase = true;
    let remainingSeconds = WORK_MIN * 60;
    let timerId = null;

    // Overtime
    let isOvertime = false;
    let overtimeSeconds = 0;

    // Tab blinking / t√≠tulo
    const baseTitle = 'Pomodoro Timer ‚Äî 25/5';
    let titleBlinkId = null;
    let titleBlinkOn = false;

    function setTitleStable(text) {
      document.title = text || baseTitle;
    }
    function startTitleBlink() {
      if (titleBlinkId) return;
      titleBlinkId = setInterval(() => {
        titleBlinkOn = !titleBlinkOn;
        const phase = isWorkPhase ? 'Trabajo' : 'Descanso';
        const icon  = isWorkPhase ? 'üíº' : 'üßò';
        const time  = isOvertime ? ('+' + fmt(overtimeSeconds)) : fmt(remainingSeconds);
        // Alterna entre mostrar y ocultar una bala para "lampeggiare"
        document.title = titleBlinkOn
          ? `‚Ä¢ ${icon} ${phase} ‚Äî ${time}`
          : `${icon} ${phase} ‚Äî ${time}`;
      }, 500);
    }
    function stopTitleBlink() {
      clearInterval(titleBlinkId);
      titleBlinkId = null;
      titleBlinkOn = false;
      setTitleStable();
    }

    // Conteos persistentes
    const persist = {
      save() {
        localStorage.setItem('pomodoro.state', JSON.stringify({
          isWorkPhase,
          remainingSeconds,
          completed: Number(completedCountEl.textContent) || 0,
          work: Number(workCountEl.textContent) || 0,
          rest: Number(breakCountEl.textContent) || 0,
          isRunning,
          isOvertime,
          overtimeSeconds
        }));
      },
      load() {
        const raw = localStorage.getItem('pomodoro.state');
        if (!raw) return;
        try {
          const s = JSON.parse(raw);
          if (typeof s.isWorkPhase === 'boolean') isWorkPhase = s.isWorkPhase;
          if (typeof s.remainingSeconds === 'number' && s.remainingSeconds > 0) remainingSeconds = s.remainingSeconds;
          isOvertime = !!s.isOvertime;
          overtimeSeconds = Number(s.overtimeSeconds) || 0;
          completedCountEl.textContent = s.completed ?? 0;
          workCountEl.textContent = s.work ?? 0;
          breakCountEl.textContent = s.rest ?? 0;
        } catch {}
      }
    };

    // Notificaciones del sistema (opcional)
    if ('Notification' in window && Notification.permission === 'default') {
      setTimeout(() => Notification.requestPermission().catch(() => {}), 1500);
    }

    // Sonido: Web Audio (seguro) + fallback <audio>
    let audioCtx = null;
    function beep() {
      const el = document.getElementById('ding');
      const tryTag = () => el.play().catch(() => {});
      try {
        if (!audioCtx) audioCtx = new (window.AudioContext || window.webkitAudioContext)();
        const o = audioCtx.createOscillator();
        const g = audioCtx.createGain();
        o.type = 'sine';
        o.frequency.setValueAtTime(880, audioCtx.currentTime);
        g.gain.setValueAtTime(0.0001, audioCtx.currentTime);
        g.gain.exponentialRampToValueAtTime(0.25, audioCtx.currentTime + 0.01);
        g.gain.exponentialRampToValueAtTime(0.0001, audioCtx.currentTime + 0.45);
        o.connect(g); g.connect(audioCtx.destination);
        o.start();
        o.stop(audioCtx.currentTime + 0.47);
      } catch {}
      tryTag();
    }

    // Formato mm:ss
    function fmt(secs) {
      const m = Math.floor(secs / 60).toString().padStart(2, '0');
      const s = Math.floor(secs % 60).toString().padStart(2, '0');
      return `${m}:${s}`;
    }

    // UI de fase
    function applyPhaseUI() {
      if (isWorkPhase) {
        phaseLabelEl.textContent = 'Trabajo';
        emojiEl.textContent = 'üíº';
        cardEl.classList.remove('bg-sky-50');
        cardEl.classList.add('bg-white/80');
        dialEl.classList.remove('overtime-glow');
        dialEl.classList.add('ring-animated');
        dialEl.style.backgroundImage = 'linear-gradient(to bottom right, rgb(217,70,239), rgb(236,72,153))';
        timeEl.classList.remove('text-red-600');
        progressEl.className = 'h-2 bg-gradient-to-r from-fuchsia-500 to-pink-500';
      } else {
        phaseLabelEl.textContent = 'Descanso';
        emojiEl.textContent = 'üßò';
        cardEl.classList.remove('bg-white/80');
        cardEl.classList.add('bg-sky-50');
        dialEl.classList.remove('overtime-glow');
        dialEl.classList.add('ring-animated');
        dialEl.style.backgroundImage = 'linear-gradient(to bottom right, rgb(14,165,233), rgb(56,189,248))';
        timeEl.classList.remove('text-red-600');
        progressEl.className = 'h-2 bg-gradient-to-r from-sky-500 to-cyan-400';
      }
      updateProgress();
    }

    // Progreso %
    function updateProgress() {
      const total = (isWorkPhase ? WORK_MIN : BREAK_MIN) * 60;
      const done = Math.min(total, total - remainingSeconds);
      const pct = Math.max(0, Math.min(100, Math.round((done / total) * 100)));
      progressEl.style.width = pct + '%';
      progressTextEl.textContent = pct + '%';
    }

    // Entrar en modo overtime (retraso)
    function enterOvertime() {
      isOvertime = true;
      overtimeSeconds = 0;
      // UI roja
      timeEl.classList.add('text-red-600');
      dialEl.classList.remove('ring-animated');
      dialEl.classList.add('overtime-glow');
      dialEl.style.backgroundImage = 'linear-gradient(to bottom right, rgb(239,68,68), rgb(248,113,113))';
      progressEl.style.width = '100%';
      progressEl.className = 'h-2 bg-red-500';
      showNotice();
      beep();
      showSystemNotification();
    }

    // Salir de overtime
    function exitOvertime() {
      isOvertime = false;
      overtimeSeconds = 0;
      timeEl.classList.remove('text-red-600');
      dialEl.classList.remove('overtime-glow');
      dialEl.classList.add('ring-animated');
      applyPhaseUI();
      hideNotice();
    }

    // Tick
    function tick() {
      if (!isRunning) return;

      if (!isOvertime) {
        remainingSeconds = Math.max(0, remainingSeconds - 1);
        timeEl.textContent = fmt(remainingSeconds);
        updateProgress();

        if (remainingSeconds === 0) {
          // No cambiamos de fase autom√°ticamente: entramos en overtime
          enterOvertime();
        }
      } else {
        // Contador de retraso
        overtimeSeconds += 1;
        timeEl.textContent = '+' + fmt(overtimeSeconds);
      }

      // Actualiza el t√≠tulo (para el lampeggio)
      // Mostramos el tiempo actual seg√∫n estado
      if (!titleBlinkId) startTitleBlink();

      persist.save();
    }

    function showNotice() {
      noticeEl.classList.remove('hidden');
      noticeEl.classList.add('animate-bounce');
    }
    function hideNotice() {
      noticeEl.classList.add('hidden');
      noticeEl.classList.remove('animate-bounce');
    }

    function showSystemNotification() {
      if ('Notification' in window && Notification.permission === 'granted') {
        const title = isWorkPhase ? '¬°Trabajo terminado!' : '¬°Descanso terminado!';
        const body = 'El contador marcar√° el retraso hasta que cambies de fase.';
        try { new Notification(title, { body }); } catch {}
      }
    }

    function switchPhase() {
      // Al cambiar de fase, salimos de overtime si estuviera activo
      exitOvertime();
      isWorkPhase = !isWorkPhase;
      remainingSeconds = (isWorkPhase ? WORK_MIN : BREAK_MIN) * 60;
      timeEl.textContent = fmt(remainingSeconds);
      applyPhaseUI();
      // Seguimos corriendo si estaba en marcha
      if (isRunning) startTimerLoop();
    }

    function startTimerLoop() {
      clearInterval(timerId);
      timerId = setInterval(tick, 1000);
      // Asegura lampeggio en marcha
      startTitleBlink();
    }

    // Controles
    startBtn.addEventListener('click', () => {
      if (!isRunning) {
        isRunning = true;
        try {
          const el = document.getElementById('ding');
          el.play().then(() => el.pause()).catch(() => {});
          if (!audioCtx) audioCtx = new (window.AudioContext || window.webkitAudioContext)();
          if (audioCtx.state === 'suspended') audioCtx.resume().catch(() => {});
        } catch {}
        startTitleBlink();
        startTimerLoop();
      }
      persist.save();
    });

    pauseBtn.addEventListener('click', () => {
      isRunning = false;
      clearInterval(timerId);
      stopTitleBlink();
      // Mantiene el tiempo visible (incluido +mm:ss si overtime)
      persist.save();
    });

    resetBtn.addEventListener('click', () => {
      isRunning = false;
      clearInterval(timerId);
      stopTitleBlink();
      isWorkPhase = true;
      exitOvertime();
      remainingSeconds = WORK_MIN * 60;
      timeEl.textContent = fmt(remainingSeconds);
      applyPhaseUI();
      hideNotice();
      persist.save();
    });

    skipBtn.addEventListener('click', () => {
      hideNotice();
      switchPhase();
      persist.save();
    });

    // Inicializar
    (function init() {
      persist.load();
      if (isOvertime) {
        // Si recargaste en overtime, restaura UI roja
        enterOvertime();
      } else {
        timeEl.textContent = fmt(remainingSeconds);
        applyPhaseUI();
      }
      updateProgress();
      setTitleStable();
    })();
  </script>
</body>
</html>
